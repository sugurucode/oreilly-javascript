## ^(a|aa)+$はなにか

- ^
  文字列の先頭。

- (a|aa)
  「a または aa」のどちらかにマッチ。

- 直前のグループ (a|aa) が1回以上繰り返されることを表します。
  つまり、「a または aa の連続」が対象。

- $
  文字列の末尾を表し、ここまでのパターンが文字列全体にマッチすることを示します。

文字列の先頭から末尾まで、1回以上の「a」か「aa」の繰り返しからなる文字列にマッチ

## 結論

時間がとてもかかる（バックトラック爆発）

## 理由

aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa!

- 最後に"!"があるので全てのパターンを試そうとする
  " ^(a|aa)+$ "の正規表現だと、区切り方を変えて全てのパターン試そうとする。

"""
例えば、文字列 "aaaa" に対しては、
(a)(a)(a)(a)

(aa)(a)(a)

(a)(aa)(a)

(a)(a)(aa)

(aa)(aa)
"""

## 対策

- 正規表現を単純化する

- 「a|aa」のように部分的に重複しやすいパターンを避ける

- Possessive quantifiers や Atomic groups（特定の正規表現エンジンで使える）を利用して無駄なバックトラックを防ぐ

- 入力に長すぎる文字列を制限する
