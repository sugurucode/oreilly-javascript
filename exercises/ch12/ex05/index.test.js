import * as fs from 'fs';
import * as path from 'path';
import { readLines } from './index.ts';
import { fileURLToPath } from 'url';
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
// テスト用のファイルパスを定義
const TEST_DIR = path.join(__dirname, 'test_files');
const FILE_NORMAL = path.join(TEST_DIR, 'normal.txt');
const FILE_EMPTY = path.join(TEST_DIR, 'empty.txt');
const FILE_NO_NEWLINE = path.join(TEST_DIR, 'no_newline.txt');
const FILE_NONEXISTENT = path.join(TEST_DIR, 'nonexistent.txt');
const FILE_LARGE = path.join(TEST_DIR, 'large.txt');
// --- テストスイート ---
describe('readLines (ファイル行読み込みジェネレータ)', () => {
    /**
     * すべてのテストの前に、テスト用のディレクトリとファイルを作成
     */
    beforeAll(() => {
        // テストディレクトリ作成
        if (!fs.existsSync(TEST_DIR)) {
            fs.mkdirSync(TEST_DIR);
        }
        // 1. 標準的なファイル (3行)
        fs.writeFileSync(FILE_NORMAL, 'Line 1\nLine 2\nLine 3');
        // 2. 空ファイル
        fs.writeFileSync(FILE_EMPTY, '');
        // 3. 最終行に改行がないファイル
        fs.writeFileSync(FILE_NO_NEWLINE, 'One line only');
        // 4. バッファサイズ(64KB)を超える大きなファイル
        // (Line X... (約10B) * 10,000行 = 約100KB)
        let largeContent = '';
        for (let i = 1; i <= 10000; i++) {
            largeContent += `This is line number ${i}\n`;
        }
        fs.writeFileSync(FILE_LARGE, largeContent);
    });
    /**
     * すべてのテストの後に、テストファイルをクリーンアップ
     */
    afterAll(() => {
        fs.unlinkSync(FILE_NORMAL);
        fs.unlinkSync(FILE_EMPTY);
        fs.unlinkSync(FILE_NO_NEWLINE);
        fs.unlinkSync(FILE_LARGE);
        fs.rmdirSync(TEST_DIR);
    });
    // --- テストケース ---
    test('標準的なファイルを正しく読み込めること (3行)', () => {
        // スプレッド構文(...)でジェネレータの結果をすべて配列に展開
        const lines = [...readLines(FILE_NORMAL)];
        expect(lines).toEqual(['Line 1', 'Line 2', 'Line 3']);
    });
    test('空のファイルを読み込んだ場合、何も返さないこと', () => {
        const lines = [...readLines(FILE_EMPTY)];
        expect(lines).toEqual([]);
    });
    test('最終行に改行がないファイルを正しく読み込めること', () => {
        const lines = [...readLines(FILE_NO_NEWLINE)];
        expect(lines).toEqual(['One line only']);
    });
    test('バッファサイズ(64KB)を超える大きなファイルを正しく読み込めること (10000行)', () => {
        const lines = [...readLines(FILE_LARGE)];
        // すべての行が読み込めたか（数）
        expect(lines.length).toBe(10000);
        // 最初と最後の行が正しいか
        expect(lines[0]).toBe('This is line number 1');
        expect(lines[9999]).toBe('This is line number 10000');
    });
    test('存在しないファイルを読み込もうとした場合、エラーがスローされること', () => {
        // ジェネレータは実行時(..するとき)にエラーを出すため、
        // expect(() => ... ) で実行する関数全体を囲む
        const readNonExistent = () => {
            // スプレッド構文でイテレータを強制的に実行
            [...readLines(FILE_NONEXISTENT)];
        };
        // ENOENT (No such file or directory) エラーを期待
        expect(readNonExistent).toThrow('ENOENT');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImluZGV4LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFDekIsT0FBTyxLQUFLLElBQUksTUFBTSxNQUFNLENBQUM7QUFDN0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN2QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sS0FBSyxDQUFDO0FBQ3BDLE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2xELE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7QUFFM0MsaUJBQWlCO0FBQ2pCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBQ3BELE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBQ3RELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQ3BELE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLGdCQUFnQixDQUFDLENBQUM7QUFDOUQsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0FBQ2hFLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBRXBELGtCQUFrQjtBQUNsQixRQUFRLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO0lBQzNDOztPQUVHO0lBQ0gsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLGNBQWM7UUFDZCxJQUFJ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