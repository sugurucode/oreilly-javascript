# 繰り返し二乗法（再帰型）の仕組み（gpt）

## 1. Math.floor(n / 2) で指数を半分にする

- 再帰的に \( x^{\lfloor n/2 \rfloor} \) を計算し、その結果を `halfPower` とします。
- 例えば \( n = 5 \) の場合、`Math.floor(5 / 2)` は `2` となり、まず \( x^2 \) を計算します。

## 2. 偶数と奇数で場合分け

- \( n \) が**偶数**なら、  
  　\( x^n = (x^{n/2})^2 \)  
  　→ `halfPower`（つまり \( x^{n/2} \) ）を2回掛けるだけでOKです。

- \( n \) が**奇数**なら、  
  　\( x^n = x \times (x^{\lfloor n/2 \rfloor})^2 \)  
  　→ 計算途中で1回余分な \( x \) を掛ける必要があります。

## 3. たとえば \( x^5 \) の場合

\[
x^5 = x \times (x^2)^2
\]

- 再帰で \( x^2 \) をまず計算して、その2乗に \( x \) を掛けることで答えを作っています。

## 擬似コード流れまとめ

- \( n \) を2でどんどん割る（再帰で小さくしていく）
- 偶数の場合は「割った結果」を2回掛ける
- 奇数の場合は「割った結果」を2回掛けて、さらに \( x \) を掛ける

## なぜ高速なのか

- 毎回指数を半分にするので、必要な計算回数が \( \log_2(n) \) のオーダーになります。
- これにより、1,000乗や1,000,000乗など、大きなべき乗の計算が一瞬で終わります。

---

この部分は再帰で指数を半分ずつ減らし、偶数/奇数で場合分けて最終的なべき乗の積を求める**高速アルゴリズム**の鍵となる処理です。
